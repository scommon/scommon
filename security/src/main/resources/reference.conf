security {
  default-profile = basic

  profiles {
    basic = {
       description = "Very simple profile with default access to the user's home directory, temp directory, application working directory and basic socket and property permissions."

       home-dir = {
         enabled = true
         actions = "read,write,execute,delete,readlink"
       }

       temp-dir = {
         enabled = true
         actions = "read,write,execute,delete,readlink"
       }

       work-dir = {
         enabled = true
         actions = "read,write,execute,readlink"
       }

       grants = [
         //Read all properties
         {
          type    = java.util.PropertyPermission
          name    = "*"
          actions = "read"
         },

         //Accept connections on, connect to, or listen to any port between 1024 and 65535 on localhost
         {
           type    = java.net.SocketPermission
           name    = "localhost:1024-"
           actions = "accept,connect,listen"
         },

         //Threads
         {
           type    = java.lang.RuntimePermission
           name    = stopThread
         },


        //Reflection
        {
          type    = java.lang.RuntimePermission
          name    = reflectionFactoryAccess
        }, {
          type    = java.lang.RuntimePermission
          name    = accessDeclaredMembers
        }, {
          type    = java.lang.reflect.ReflectPermission
          name    = suppressAccessChecks
        }, {
          type    = java.lang.reflect.AccessDeclaredMemberPermission
        }, {
          type    = java.lang.reflect.SuppressAccessCheckPermission
        }, {
          type    = java.lang.RuntimePermission
          name    = getClassLoader
        }, {
          type    = java.lang.RuntimePermission
          name    = getProtectionDomain
        },

        //Logging
        {
          type    = java.util.logging.LoggingPermission
          name    = control
        },

         //Socket access permissions
         {
          type    = java.lang.RuntimePermission
          name    = loadLibrary.net
        }, {
          type    = java.net.NetPermission
          name    = getProxySelector
        }, {
          type    = java.lang.RuntimePermission
          name    = readFileDescriptor
        }, {
          type    = java.lang.RuntimePermission
          name    = writeFileDescriptor
        }, {
          type    = java.net.NetPermission
          name    = getCookieHandler
        }, {
          type    = java.net.NetPermission
          name    = getResponseCache
        }
       ]
    }
  }

  sandbox {
    default = standard-security-profile
    standard-profile = {
      name = standard-security-profile

      enable-home-dir = true
      enable-temp-dir = true
      enable-work-dir = true
      load-classpath  = true

      allow-file-permissions = [
      ]
      packages-for-app-loader = [
        sun.reflect,
        org.scommon,
        scala
      ]
      allow-packages = [
        java.lang,
        java.io,
        java.math,
        java.net,
        java.nio,
        java.security,
        java.sql,
        java.text,
        java.util,
        javax.script,
        javax.swing,
        sun.reflect,
        scala,
        org.scommon
      ]
      allow-classes = [
        net.datenwerke.sandbox.util.VariableAssignment
      ]
      allow-permissions = [
        //Property access
        {
          type    = java.util.PropertyPermission
          name    = "*"
          actions = "read,write"
        }, {
          type    = java.util.PropertyPermission
          name    = awt.toolkit
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = control
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = file.encoding
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = file.encoding.pkg
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = file.separator
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.awt.graphicsenv
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.awt.printerjob
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.class.path
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.class.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.endorsed.dirs
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.ext.dirs
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.home
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.io.tmpdir
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.library.path
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.runtime.name
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.runtime.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.specification.name
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.specification.vendor
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.specification.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vendor
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vendor.url
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vendor.url.bug
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.info
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.name
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.specification.name
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.specification.vendor
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.specification.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.vendor
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.vm.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = line.separator
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = os.arch
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = os.name
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = os.version
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = path.separator
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.arch.data.model
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.boot.class.path
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.boot.library.path
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.cpu.endian
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.cpu.isalist
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.desktop
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.io.unicode.encoding
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.java.command
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.java.launcher
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.jnu.encoding
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.management.compiler
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.os.patch.level
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.country
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.dir
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.home
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.language
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.name
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.script
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.timezone
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = user.variant
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = visualvm.id
          actions = read
        }, {
          type    = java.lang.RuntimePermission
          name    = modifyThreadGroup
        }, {
          type    = java.lang.RuntimePermission
          name    = modifyThread
        }, {
          type    = java.lang.RuntimePermission
          name    = setContextClassLoader
        },

        //Reflection
        {
          type    = java.lang.RuntimePermission
          name    = reflectionFactoryAccess
        }, {
          type    = java.lang.RuntimePermission
          name    = accessDeclaredMembers
        }, {
          type    = java.lang.reflect.ReflectPermission
          name    = suppressAccessChecks
        }, {
          type    = java.lang.reflect.AccessDeclaredMemberPermission
        }, {
          type    = java.lang.reflect.SuppressAccessCheckPermission
        }, {
          type    = java.lang.RuntimePermission
          name    = getClassLoader
        }, {
          type    = java.lang.RuntimePermission
          name    = getProtectionDomain
        }, {
          type    = java.util.PropertyPermission
          name    = sun.reflect.proxy.allowsNewInstance
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.reflect.proxy.allowsNullLoader
          actions = read
        },

        //Logging
        {
          type    = java.util.logging.LoggingPermission
          name    = control
        }, {
          type    = java.util.PropertyPermission
          name    = java.util.logging.SimpleFormatter.format
          actions = read
        },

        //Socket
        {
          type    = java.lang.RuntimePermission
          name    = loadLibrary.net
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.useExclusiveBind
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = java.net.useSystemProxies
          actions = read
        }, {
          type    = java.net.NetPermission
          name    = getProxySelector
        }, {
          type    = java.util.PropertyPermission
          name    = socksProxyHost
          actions = read
        }, {
          type    = java.lang.RuntimePermission
          name    = readFileDescriptor
        }, {
          type    = java.lang.RuntimePermission
          name    = writeFileDescriptor
        }, {
          type    = java.util.PropertyPermission
          name    = java.protocol.handler.pkgs
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.maxRedirects
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.agent
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.auth.digest.validateProxy
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.auth.digest.validateServer
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.http.errorstream.enableBuffering
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.http.errorstream.timeout
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.http.errorstream.bufferSize
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.http.allowRestrictedHeaders
          actions = read
        }, {
          type    = java.net.NetPermission
          name    = getCookieHandler
        }, {
          type    = java.net.NetPermission
          name    = getResponseCache
        }, {
          type    = java.util.PropertyPermission
          name    = http.proxyHost
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = proxyHost
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.client.defaultReadTimeout
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.client.defaultConnectTimeout
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.keepAlive
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.http.retryPost
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.http.captureRules
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.auth.serializeRequests
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = http.maxConnections
          actions = read
        }, {
          type    = java.util.PropertyPermission
          name    = sun.net.maxDatagramSockets
          actions = read
        }
      ]

      deny-permissions = [
        //Properties

        //Reflection
        {
          type    = java.lang.RuntimePermission
          name    = createClassLoader
        },

        //Class loaders
        {
          type    = java.lang.reflect.SuppressAccessCheckPermission
          name    = net.datenwerke.sandbox.SandboxSecurityManager
        }, {
          type    = java.lang.reflect.AccessDeclaredMemberPermission
          name    = net.datenwerke.sandbox.SandboxSecurityManager
        }, {
          type    = java.lang.reflect.SuppressAccessCheckPermission
          name    = net.datenwerke.sandbox.SandboxLoader
        }, {
          type    = java.lang.reflect.AccessDeclaredMemberPermission
          name    = net.datenwerke.sandbox.SandboxLoader
        }
      ]

      allow-socket-permissions = [
        {
          host    = "*:0-"
          actions = "accept,connect,resolve,listen"
        }
      ]
    }

    profiles = [ standard-profile ]
  }
}

//Ways to augment the standard profile:

//security.sandbox.standard-profile.allow-permissions += {
//  type    = java.util.PropertyPermission
//  name    = sun.reflect.proxy.allowsNullLoader
//  actions = read
//}

//security.sandbox.standard-profile {
//  allow-permissions += {
//    type    = java.util.PropertyPermission
//    name    = sun.reflect.proxy.allowsNullLoader
//    actions = read
//  }
//}
